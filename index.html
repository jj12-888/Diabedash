<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiabeDash - Complete App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
        
        /* --- GLOBAL STYLES --- */
        body {
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #6e48aa, #9d50bb);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        /* Utility to hide pages */
        .page-section {
            display: none;
            width: 100%;
            min-height: 100vh;
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- BUTTON STYLES (Shared) --- */
        .btn {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 14px;
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
            border-color: white;
        }

        /* --- LOGIN PAGE STYLES --- */
        #page-login {
            display: none;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        #page-login.active {
            display: flex;
        }

        .login-card {
            background: linear-gradient(135deg, #43cea2, #185a9d);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: visible;
        }

        .avatar-container {
            width: 80px;
            height: 80px;
            margin: -80px auto 20px auto;
            position: relative;
            background: white;
            border-radius: 50%;
            border: 4px solid #fff;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Quicksand', sans-serif;
            font-size: 16px;
            outline: none;
            margin-bottom: 20px;
            color: #333;
        }

        /* --- DASHBOARD STYLES --- */
        #page-dashboard {
            padding: 20px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto 30px auto;
        }

        .stat-card {
            display: flex;
            flex-direction: column;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .badge {
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-green { background: rgba(168, 255, 120, 0.3); color: #a8ff78; }
        .badge-red { background: rgba(255, 117, 140, 0.3); color: #ff758c; }

        /* --- GAME STYLES --- */
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        #player {
            position: absolute;
            width: 80px;
            height: 100px;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            transition: left 0.1s ease-out;
        }
        
        .lane {
            position: absolute;
            bottom: 0;
            width: 33.33%;
            height: 100%;
        }
        
        #lane-left { left: 0; }
        #lane-center { left: 33.33%; }
        #lane-right { left: 66.66%; }
        
        .food-item {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            animation: fall linear forwards;
            z-index: 50;
        }
        
        .healthy {
            background: radial-gradient(circle at 30% 30%, #a8ff78, #78ffd6);
            box-shadow: 0 0 20px rgba(168, 255, 120, 0.7);
        }
        
        .unhealthy {
            background: radial-gradient(circle at 30% 30%, #ff758c, #ff7eb3);
            box-shadow: 0 0 20px rgba(255, 117, 140, 0.7);
        }
        
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to bottom, #7b4397, #dc2430);
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        
        .ground-segment {
            width: 33.33%;
            height: 100%;
            border-right: 2px dashed rgba(255, 255, 255, 0.3);
            box-sizing: border-box;
        }
        
        .building {
            position: absolute;
            bottom: 100px;
            width: 80px;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            animation: buildingMove 8s linear infinite;
        }
        
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            filter: blur(5px);
            animation: cloudMove linear infinite;
        }
        
        @keyframes fall {
            from { transform: translateY(-100px); }
            to { transform: translateY(calc(100vh - 50px)); }
        }
        
        @keyframes buildingMove {
            from { transform: translateX(120vw); }
            to { transform: translateX(-20vw); }
        }
        
        @keyframes cloudMove {
            from { transform: translateX(120vw); }
            to { transform: translateX(-20vw); }
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #43cea2, #185a9d);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        /* Character CSS */
        .player-character { width: 80px; height: 100px; position: relative; }
        .player-body { position: absolute; bottom: 0; width: 100%; height: 60%; background: linear-gradient(135deg, #74ebd5, #ACB6E5); border-radius: 50% 50% 40% 40%; overflow: hidden; }
        .player-shirt { position: absolute; bottom: 0; width: 100%; height: 60%; background: linear-gradient(135deg, #a18cd1, #fbc2eb); border-radius: 40% 40% 0 0; }
        .player-head { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 70%; height: 45%; background: #ffdde1; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .player-hair { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 75%; height: 25%; background: #6a4126; border-radius: 50% 50% 0 0; }
        .player-eye { position: absolute; width: 10px; height: 10px; background: #333; border-radius: 50%; top: 15px; transition: all 0.3s ease; }
        .player-eye.left { left: 15px; }
        .player-eye.right { right: 15px; }
        .player-blush { position: absolute; width: 15px; height: 8px; background: rgba(255, 150, 150, 0.6); border-radius: 50%; top: 22px; }
        .player-blush.left { left: 10px; }
        .player-blush.right { right: 10px; }
        .player-mouth { position: absolute; width: 20px; height: 10px; background: #ff6b6b; border-radius: 0 0 10px 10px; bottom: 10px; left: 50%; transform: translateX(-50%); transition: all 0.2s ease; }
        .player-arm { position: absolute; width: 12px; height: 35px; background: #ffdde1; border-radius: 10px; top: 40%; transition: all 0.3s ease; }
        .player-arm.left { left: -5px; transform: rotate(-20deg); }
        .player-arm.right { right: -5px; transform: rotate(20deg); }
        .player-leg { position: absolute; width: 15px; height: 25px; background: #ffdde1; border-radius: 10px; bottom: -15px; }
        .player-leg.left { left: 20px; }
        .player-leg.right { right: 20px; }
        
        /* Mini character for Login/Avatar */
        .mini-head { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 50px; height: 45px; background: #ffdde1; border-radius: 50%; }
        .mini-hair { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 55px; height: 20px; background: #6a4126; border-radius: 50% 50% 0 0; }
        .mini-eye { position: absolute; width: 6px; height: 6px; background: #333; border-radius: 50%; top: 15px; }

        /* Animations */
        .jump-animation { animation: jump 0.5s ease-out; }
        @keyframes jump {
            0% { transform: translateY(0) translateX(-50%); }
            50% { transform: translateY(-120px) translateX(-50%); }
            100% { transform: translateY(0) translateX(-50%); }
        }
        
        .eating-animation { animation: eating 0.5s ease-in-out; }
        @keyframes eating {
            0% { height: 10px; width: 20px; }
            50% { height: 20px; width: 30px; border-radius: 50%; }
            100% { height: 10px; width: 20px; }
        }
        
        .happy-eyes { animation: happyEyes 0.5s ease-in-out; }
        @keyframes happyEyes {
            0% { height: 10px; }
            50% { height: 2px; border-radius: 50%; top: 20px; }
            100% { height: 10px; }
        }
        
        .sad-eyes { animation: sadEyes 0.5s ease-in-out; }
        @keyframes sadEyes {
            0% { height: 10px; border-radius: 50%; }
            50% { height: 15px; border-radius: 50% 50% 0 0; top: 12px; }
            100% { height: 10px; border-radius: 50%; }
        }
        
        .arm-eating-left { animation: armEatingLeft 0.5s ease-in-out; }
        @keyframes armEatingLeft {
            0% { transform: rotate(-20deg); }
            50% { transform: rotate(-40deg) translateY(-5px); }
            100% { transform: rotate(-20deg); }
        }
        
        .arm-eating-right { animation: armEatingRight 0.5s ease-in-out; }
        @keyframes armEatingRight {
            0% { transform: rotate(20deg); }
            50% { transform: rotate(40deg) translateY(-5px); }
            100% { transform: rotate(20deg); }
        }
        
        .score-popup {
            position: absolute;
            font-weight: bold;
            font-size: 30px;
            animation: scorePopup 1s ease-out forwards;
            z-index: 200;
        }
        
        @keyframes scorePopup {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-70px); }
        }

        /* Multiplayer Panel */
        .multiplayer-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            color: white;
            max-width: 200px;
            z-index: 500;
        }
        
        .player-entry { display: flex; align-items: center; margin-bottom: 8px; }
        .player-avatar { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #a18cd1, #fbc2eb); margin-right: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; }
        
        .round-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            z-index: 500;
        }
        
        .round-pill { display: inline-block; width: 30px; height: 10px; border-radius: 5px; margin: 0 5px; background: rgba(255, 255, 255, 0.3); }
        .round-pill.active { background: white; }

        /* Chatbot CSS */
        .chatbot-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
        }
        
        .chatbot-container {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        .chatbot-header { padding: 20px; border-bottom: 2px solid rgba(255, 255, 255, 0.2); text-align: center; background: rgba(255, 255, 255, 0.1); border-radius: 20px 20px 0 0; }
        .chatbot-avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #ffecd2, #fcb69f); display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 10px; animation: bounce 2s infinite; }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 18px; animation: messageSlide 0.3s ease-out; white-space: pre-wrap; }
        @keyframes messageSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .message.bot { background: rgba(255, 255, 255, 0.2); align-self: flex-start; border-bottom-left-radius: 5px; }
        .message.user { background: linear-gradient(135deg, #ff9a9e, #fecfef); color: #333; align-self: flex-end; border-bottom-right-radius: 5px; }
        
        .chat-input-area { padding: 20px; border-top: 2px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); border-radius: 0 0 20px 20px; }
        .quick-responses { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .quick-response-btn { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 12px; border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.3s; }
        .quick-response-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        .chat-input-container { display: flex; gap: 10px; align-items: center; }
        .chat-input { flex: 1; padding: 12px 16px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px; outline: none; }
        .chat-input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .chat-send-btn { background: linear-gradient(135deg, #ff9a9e, #fecfef); border: none; width: 45px; height: 45px; border-radius: 50%; color: #333; font-size: 18px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .chat-send-btn:hover { transform: scale(1.1); }
        .chat-close-btn { position: absolute; top: 15px; right: 15px; background: rgba(255, 255, 255, 0.2); border: none; width: 35px; height: 35px; border-radius: 50%; color: white; font-size: 18px; cursor: pointer; transition: all 0.3s; }
        .chat-close-btn:hover { background: rgba(255, 255, 255, 0.3); }
        
        .typing-indicator { display: flex; align-items: center; gap: 5px; padding: 12px 16px; background: rgba(255, 255, 255, 0.2); border-radius: 18px; border-bottom-left-radius: 5px; max-width: 80px; align-self: flex-start; }
        .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: white; animation: typingDot 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingDot { 0%, 60%, 100% { opacity: 0.3; } 30% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="page-login" class="page-section active">
        <div class="login-card">
            <div class="avatar-container">
                <div class="mini-head">
                    <div class="mini-hair"></div>
                    <div class="mini-eye" style="left: 12px;"></div>
                    <div class="mini-eye" style="right: 12px;"></div>
                    <div style="position:absolute; bottom:8px; left:50%; transform:translateX(-50%); width:10px; height:5px; background:#ff6b6b; border-radius:0 0 5px 5px;"></div>
                </div>
            </div>

            <h1 class="text-3xl font-bold mb-6">Welcome Back!</h1>
            
            <form onsubmit="navigateTo('dashboard'); return false;">
                <div class="text-left mb-4">
                    <label class="block mb-1 font-semibold text-sm">Username</label>
                    <input type="text" class="form-input mb-0" placeholder="Runner123" required>
                </div>
                
                <div class="text-left mb-4">
                    <label class="block mb-1 font-semibold text-sm">Password</label>
                    <input type="password" class="form-input mb-0" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>

                <button type="submit" class="btn w-full mt-4">Login</button>
            </form>

            <p class="mt-4 text-sm opacity-90">New runner? <a href="#" class="font-bold underline text-white">Create Account</a></p>
        </div>
    </div>

    <div id="page-dashboard" class="page-section">
        <div class="max-w-[1200px] mx-auto pt-6 flex justify-between items-center mb-8">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-pink-300 to-pink-100 rounded-full flex items-center justify-center font-bold text-gray-800 text-xl">J</div>
                <div>
                    <h2 class="text-xl font-bold">Hi, Jia!</h2>
                    <span class="text-sm opacity-80">Level 5 Runner</span>
                </div>
            </div>
            <button onclick="navigateTo('login')" class="btn-outline">Log Out</button>
        </div>

        <div class="stats-grid">
            <div class="glass-panel stat-card">
                <span class="text-sm opacity-80 uppercase tracking-widest">Total Score</span>
                <span class="text-3xl font-bold my-2">2,450 ‚Çπ</span>
            </div>
            <div class="glass-panel stat-card">
                <span class="text-sm opacity-80 uppercase tracking-widest">Healthy Eaten ü•ó</span>
                <span class="text-3xl font-bold my-2 text-green-300">142</span>
            </div>
            <div class="glass-panel stat-card">
                <span class="text-sm opacity-80 uppercase tracking-widest">Junk Avoided üçî</span>
                <span class="text-3xl font-bold my-2 text-red-300">89</span>
            </div>
            <div class="glass-panel stat-card">
                <span class="text-sm opacity-80 uppercase tracking-widest">Highest Rank</span>
                <span class="text-3xl font-bold my-2 text-yellow-300">1st üèÜ</span>
            </div>
        </div>

        <div class="max-w-[1200px] mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-panel">
                <div class="text-xl font-bold mb-4 flex items-center gap-2"><span>üïí Recent Runs</span></div>
                <div class="list-item">
                    <div>
                        <div class="font-bold">Afternoon Run</div>
                        <div class="text-xs opacity-70">Today, 2:30 PM</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold">120 ‚Çπ</div>
                        <span class="badge badge-green">Win</span>
                    </div>
                </div>
                <div class="list-item">
                    <div>
                        <div class="font-bold">Morning Jog</div>
                        <div class="text-xs opacity-70">Yesterday, 9:00 AM</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold">85 ‚Çπ</div>
                        <span class="badge badge-red">2nd</span>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <div class="text-xl font-bold mb-4 flex items-center gap-2"><span>üéØ Weekly Goals</span></div>
                <div class="list-item">
                    <div class="flex-1">
                        <div class="flex justify-between mb-1">
                            <span class="font-bold text-sm">Collect 50 Apples</span>
                            <span class="text-sm">35/50</span>
                        </div>
                        <div class="w-full bg-black/20 rounded-full h-2">
                            <div class="bg-red-400 h-2 rounded-full" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
                <div class="list-item">
                    <div class="flex-1">
                        <div class="flex justify-between mb-1">
                            <span class="font-bold text-sm">Avoid 20 Burgers</span>
                            <span class="text-sm">20/20</span>
                        </div>
                        <div class="w-full bg-black/20 rounded-full h-2">
                            <div class="bg-green-400 h-2 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                    <span class="ml-3 badge badge-green">Claim</span>
                </div>
            </div>
        </div>

        <div class="max-w-[1200px] mx-auto text-center mt-8 bg-gradient-to-r from-[#43cea2] to-[#185a9d] p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4">Ready to beat your high score?</h2>
            <button onclick="navigateTo('game')" class="btn text-lg px-8 py-3">Play DiabeDash Now!</button>
        </div>
    </div>

    <div id="page-game" class="page-section">
        <div id="game-container">
            <div class="ground">
                <div class="ground-segment"></div>
                <div class="ground-segment"></div>
                <div class="ground-segment"></div>
            </div>
            
            <div id="lane-left" class="lane"></div>
            <div id="lane-center" class="lane"></div>
            <div id="lane-right" class="lane"></div>
            
            <div id="player">
                <div class="player-character">
                    <div class="player-head">
                        <div class="player-hair"></div>
                        <div class="player-eye left"></div>
                        <div class="player-eye right"></div>
                        <div class="player-blush left"></div>
                        <div class="player-blush right"></div>
                        <div class="player-mouth"></div>
                    </div>
                    <div class="player-body">
                        <div class="player-shirt"></div>
                        <div class="player-arm left"></div>
                        <div class="player-arm right"></div>
                        <div class="player-leg left"></div>
                        <div class="player-leg right"></div>
                    </div>
                </div>
            </div>
            
            <div class="round-indicator">
                <div>Round <span id="current-round">1</span>/3</div>
                <div class="mt-2">
                    <span class="round-pill active"></span>
                    <span class="round-pill"></span>
                    <span class="round-pill"></span>
                </div>
            </div>
            
            <div class="multiplayer-panel">
                <h3 class="text-lg font-bold mb-2">Leaderboard</h3>
                <div id="leaderboard">
                    <div class="player-entry">
                        <div class="player-avatar">Y</div>
                        <div>You: <span id="player-score">0</span> ‚Çπ</div>
                    </div>
                    <div class="player-entry">
                        <div class="player-avatar">A</div>
                        <div>AI 1: <span id="ai-score-1">0</span> ‚Çπ</div>
                    </div>
                    <div class="player-entry">
                        <div class="player-avatar">A</div>
                        <div>AI 2: <span id="ai-score-2">0</span> ‚Çπ</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="start-modal" class="modal">
            <div class="modal-content">
                <h1 class="text-3xl font-bold mb-4">DiabeDash</h1>
                <p class="mb-6">Navigate through a vibrant world collecting healthy foods for +10‚Çπ while avoiding unhealthy ones that cost you -5‚Çπ!</p>
                
                <div class="mb-6">
                    <p class="font-bold mb-2">How to play:</p>
                    <p>‚Üê ‚Üí Arrow keys to move between lanes</p>
                    <p>‚Üë Arrow key to jump</p>
                </div>
                
                <button id="start-game" class="btn">Start Game</button>
                <button onclick="navigateTo('dashboard')" class="btn-outline mt-4 block mx-auto">Back to Dashboard</button>
            </div>
        </div>
        
        <div id="round-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Round <span id="round-number">1</span> Complete!</h2>
                <p class="mb-4">Your score: <span id="round-score">0</span> ‚Çπ</p>
                <button id="next-round" class="btn">Next Round</button>
            </div>
        </div>
        
        <div id="game-over-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Game Over!</h2>
                <p class="mb-4">Final Score: <span id="final-score">0</span> ‚Çπ</p>
                
                <div class="game-over-stats bg-white/10 p-4 rounded-xl mb-4">
                    <h3 class="text-lg font-bold mb-2">Game Stats</h3>
                    <div class="flex justify-between mb-1">
                        <span>Healthy foods collected:</span>
                        <span id="healthy-collected">0</span>
                    </div>
                    <div class="flex justify-between mb-1">
                        <span>Unhealthy foods avoided:</span>
                        <span id="unhealthy-avoided">0</span>
                    </div>
                    <div class="flex justify-between font-bold">
                        <span>Final Ranking:</span>
                        <span id="final-rank">1st</span>
                    </div>
                </div>
                
                <div class="flex flex-wrap justify-center gap-2">
                    <button id="play-again" class="btn">Play Again</button>
                    <button id="chat-with-coach" class="btn">Chat with Coach ü•ó</button>
                    <button onclick="navigateTo('dashboard')" class="btn-outline">Exit</button>
                </div>
            </div>
        </div>
        
        <div id="chatbot-modal" class="chatbot-modal">
            <div class="chatbot-container">
                <button class="chat-close-btn" id="close-chatbot">√ó</button>
                <div class="chatbot-header">
                    <div class="chatbot-avatar">ü§ñ</div>
                    <h3>Gemini Healthy Coach</h3>
                    <p style="font-size: 14px; opacity: 0.8;">Hi! I'm your AI Coach, powered by Gemini. Ask me anything!</p>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    </div>
                
                <div class="chat-input-area">
                    <div class="quick-responses" id="quick-responses">
                        <button class="quick-response-btn" data-response="What are healthy snacks?">Healthy Snacks üçé</button>
                        <button class="quick-response-btn" data-response="Tell me about vegetables">About Veggies ü•ï</button>
                        <button class="quick-response-btn" data-response="Why should I drink water?">Why Water? üíß</button>
                        <button class="quick-response-btn" data-response="Fun food facts please!">Fun Facts üåü</button>
                    </div>
                    
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chat-input" placeholder="Ask me about healthy eating...">
                        <button class="chat-send-btn" id="chat-send">‚û§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- PAGE NAVIGATION LOGIC ---
        function navigateTo(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            const target = document.getElementById(`page-${pageId}`);
            if (target) {
                target.classList.add('active');
            }

            // Handle specific page logic
            if (pageId === 'game') {
                updatePlayerPosition(); // Fix initial position
                document.getElementById('start-modal').style.display = 'flex'; // Reset start modal
                document.body.style.overflow = 'hidden'; // Lock scroll for game
            } else {
                document.body.style.overflow = 'auto'; // Enable scroll for dashboards
                if (gameActive) {
                    endRound(); // Stop game if leaving mid-game
                    gameActive = false;
                }
            }
        }

        // --- GEMINI CHATBOT CONFIGURATION ---
        // ‚ö†Ô∏è WARNING: DO NOT USE THIS METHOD IN PRODUCTION. API KEYS MUST BE KEPT SECRET.
        // 1. Get a key from https://aistudio.google.com/
        // 2. Paste it below inside the quotes
        const GEMINI_API_KEY = "YOUR_GEMINI_API_KEY_HERE"; 
        const GEMINI_MODEL = "gemini-1.5-flash";
        
        // This is the REST API Endpoint for Gemini
        const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
        
        let chatHistory = [];
        const SYSTEM_INSTRUCTION = "You are the Healthy Eating Coach for a runner game called DiabeDash. Your goal is to provide encouraging, short, and accurate advice about healthy eating, especially for kids and runners. Your tone must be upbeat and positive.";

        // --- GAME VARIABLES ---
        let gameActive = false;
        let playerLane = 1; 
        let score = 0;
        let currentRound = 1;
        let gameSpeed = 4; 
        let foodInterval;
        let buildingInterval;
        let cloudInterval;
        let isJumping = false;
        let isEating = false;
        let healthyCollected = 0;
        let unhealthyAvoided = 0;
        let totalUnhealthy = 0;
        
        const aiPlayers = [
            { id: 1, score: 0, scoreIncrement: Math.random() * 5 + 3 },
            { id: 2, score: 0, scoreIncrement: Math.random() * 5 + 2 }
        ];
        
        const healthyFoods = [
            { emoji: "ü•ó", name: "Salad" }, { emoji: "ü•¶", name: "Broccoli" }, { emoji: "üçé", name: "Apple" },
            { emoji: "ü•ë", name: "Avocado" }, { emoji: "ü•ï", name: "Carrot" }, { emoji: "üçì", name: "Strawberry" }
        ];
        
        const unhealthyFoods = [
            { emoji: "üçî", name: "Burger" }, { emoji: "üçï", name: "Pizza" }, { emoji: "üç©", name: "Donut" },
            { emoji: "üç¶", name: "Ice Cream" }, { emoji: "üç´", name: "Chocolate" }, { emoji: "ü•§", name: "Soda" }
        ];
        
        // DOM Elements
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const startModal = document.getElementById('start-modal');
        const roundModal = document.getElementById('round-modal');
        const gameOverModal = document.getElementById('game-over-modal');
        const playerScoreElement = document.getElementById('player-score');
        
        // Character Parts
        const playerMouth = document.querySelector('.player-mouth');
        const playerEyeLeft = document.querySelector('.player-eye.left');
        const playerEyeRight = document.querySelector('.player-eye.right');
        const playerArmLeft = document.querySelector('.player-arm.left');
        const playerArmRight = document.querySelector('.player-arm.right');
        
        // Chatbot Elements
        const chatbotModal = document.getElementById('chatbot-modal');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const quickResponseBtns = document.querySelectorAll('.quick-response-btn');

        // --- EVENT LISTENERS ---
        document.getElementById('start-game').addEventListener('click', startGame);
        document.getElementById('next-round').addEventListener('click', startNextRound);
        document.getElementById('play-again').addEventListener('click', resetGame);
        document.getElementById('chat-with-coach').addEventListener('click', openChatbot);
        document.getElementById('close-chatbot').addEventListener('click', closeChatbot);
        document.getElementById('chat-send').addEventListener('click', sendMessage);
        document.getElementById('chat-input').addEventListener('keypress', handleChatKeyPress);
        
        quickResponseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                chatInput.value = btn.dataset.response;
                sendMessage();
            });
        });

        // --- GAME LOGIC ---
        function startGame() {
            startModal.style.display = 'none';
            gameActive = true;
            score = 0;
            updateScore();
            aiPlayers.forEach(ai => { ai.score = 0; document.getElementById(`ai-score-${ai.id}`).textContent = '0'; });
            startGeneratingFood();
            startGeneratingBuildings();
            startGeneratingClouds();
            startUpdatingAIScores();
            document.addEventListener('keydown', handleKeyPress);
            playerLane = 1;
            updatePlayerPosition();
        }
        
        function startNextRound() {
            roundModal.style.display = 'none';
            currentRound++;
            document.getElementById('current-round').textContent = currentRound;
            document.querySelectorAll('.round-pill').forEach((pill, index) => pill.classList.toggle('active', index < currentRound));
            gameSpeed += 0.8;
            gameActive = true;
            startGeneratingFood();
            startGeneratingBuildings();
            startGeneratingClouds();
            startUpdatingAIScores();
        }
        
        function resetGame() {
            gameOverModal.style.display = 'none';
            currentRound = 1;
            document.getElementById('current-round').textContent = currentRound;
            gameSpeed = 4;
            score = 0;
            healthyCollected = 0;
            unhealthyAvoided = 0;
            document.querySelectorAll('.round-pill').forEach((pill, index) => pill.classList.toggle('active', index === 0));
            updateScore();
            startGame();
        }
        
        function endRound() {
            gameActive = false;
            clearInterval(foodInterval);
            clearInterval(buildingInterval);
            clearInterval(cloudInterval);
            document.querySelectorAll('.food-item').forEach(item => item.remove());
            
            if (currentRound < 3) {
                document.getElementById('round-number').textContent = currentRound;
                document.getElementById('round-score').textContent = score;
                roundModal.style.display = 'flex';
            } else {
                endGame();
            }
        }
        
        function endGame() {
            const allScores = [score, ...aiPlayers.map(ai => ai.score)].sort((a, b) => b - a);
            const playerRank = allScores.indexOf(score) + 1;
            let rankText = playerRank === 1 ? "1st Place üèÜ" : playerRank === 2 ? "2nd Place ü•à" : playerRank === 3 ? "3rd Place ü•â" : `${playerRank}th Place`;
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('healthy-collected').textContent = healthyCollected;
            document.getElementById('unhealthy-avoided').textContent = unhealthyAvoided;
            document.getElementById('final-rank').textContent = rankText;
            gameOverModal.style.display = 'flex';
        }
        
        function handleKeyPress(e) {
            if (!gameActive) return;
            switch(e.key) {
                case 'ArrowLeft': if (playerLane > 0) { playerLane--; updatePlayerPosition(); } break;
                case 'ArrowRight': if (playerLane < 2) { playerLane++; updatePlayerPosition(); } break;
                case 'ArrowUp': if (!isJumping) { jump(); } break;
            }
        }
        
        function updatePlayerPosition() {
            const laneWidth = window.innerWidth / 3;
            const lanePositions = [laneWidth * 0.5, laneWidth * 1.5, laneWidth * 2.5];
            player.style.left = `${lanePositions[playerLane]}px`;
        }
        
        function jump() {
            isJumping = true;
            player.classList.add('jump-animation');
            setTimeout(() => { player.classList.remove('jump-animation'); isJumping = false; }, 500);
        }
        
        function playEatingAnimation(isHealthy) {
            if (isEating) return;
            isEating = true;
            playerMouth.classList.add('eating-animation');
            playerArmLeft.classList.add('arm-eating-left');
            playerArmRight.classList.add('arm-eating-right');
            if (isHealthy) { playerEyeLeft.classList.add('happy-eyes'); playerEyeRight.classList.add('happy-eyes'); }
            else { playerEyeLeft.classList.add('sad-eyes'); playerEyeRight.classList.add('sad-eyes'); }
            setTimeout(() => {
                playerMouth.classList.remove('eating-animation');
                playerArmLeft.classList.remove('arm-eating-left');
                playerArmRight.classList.remove('arm-eating-right');
                playerEyeLeft.classList.remove('happy-eyes', 'sad-eyes');
                playerEyeRight.classList.remove('happy-eyes', 'sad-eyes');
                isEating = false;
            }, 500);
        }
        
        function startGeneratingFood() {
            const minInterval = 1000 - (gameSpeed * 100);
            const maxInterval = 2000 - (gameSpeed * 150);
            const generateAndScheduleNext = () => {
                if (!gameActive) return;
                generateFoodItem();
                clearInterval(foodInterval);
                foodInterval = setTimeout(generateAndScheduleNext, Math.random() * (maxInterval - minInterval) + minInterval);
            }
            generateAndScheduleNext();
        }
        
        function generateFoodItem() {
            const foodItem = document.createElement('div');
            const isHealthy = Math.random() > 0.4;
            const food = (isHealthy ? healthyFoods : unhealthyFoods)[Math.floor(Math.random() * (isHealthy ? healthyFoods : unhealthyFoods).length)];
            
            foodItem.className = `food-item ${isHealthy ? 'healthy' : 'unhealthy'}`;
            foodItem.innerHTML = food.emoji;
            const lane = Math.floor(Math.random() * 3);
            const laneCenter = (window.innerWidth / 3) * (lane + 0.5);
            foodItem.style.left = `${laneCenter - 40}px`;
            foodItem.style.animationDuration = `${2.5 - (gameSpeed * 0.2)}s`;
            
            gameContainer.appendChild(foodItem);
            
            foodItem.addEventListener('animationend', () => {
                const laneMatch = lane === playerLane;
                if (laneMatch && !isJumping) {
                    if (isHealthy) {
                        updateScore(10); healthyCollected++; showScorePopup(foodItem, '+10', 'text-green-400');
                        playEatingAnimation(true); animateFoodBeingEaten(foodItem);
                    } else {
                        updateScore(-5); showScorePopup(foodItem, '-5', 'text-red-400');
                        playEatingAnimation(false); animateFoodBeingEaten(foodItem);
                    }
                } else {
                    if (!isHealthy && laneMatch) unhealthyAvoided++;
                    foodItem.remove();
                }
            });
        }

        function animateFoodBeingEaten(foodItem) {
            const playerRect = player.getBoundingClientRect();
            const foodRect = foodItem.getBoundingClientRect();
            foodItem.style.position = 'fixed';
            foodItem.style.top = `${foodRect.top}px`;
            foodItem.style.left = `${foodRect.left}px`;
            foodItem.style.animation = 'none';
            setTimeout(() => {
                foodItem.style.transition = 'all 0.3s ease-in-out';
                foodItem.style.transform = `translate(${(playerRect.left + playerRect.width/2) - (foodRect.left + foodRect.width/2)}px, ${(playerRect.top + playerRect.height/3) - (foodRect.top + foodRect.height/2)}px) scale(0.5)`;
                foodItem.style.opacity = '0';
                setTimeout(() => foodItem.remove(), 300);
            }, 10);
        }

        function showScorePopup(element, text, colorClass) {
            const popup = document.createElement('div');
            popup.className = `score-popup ${colorClass}`;
            popup.textContent = text;
            const rect = element.getBoundingClientRect();
            popup.style.left = `${rect.left}px`;
            popup.style.top = `${rect.top - 20}px`;
            gameContainer.appendChild(popup);
            popup.addEventListener('animationend', () => popup.remove());
        }

        function updateScore(points = 0) {
            score += points;
            playerScoreElement.textContent = score;
        }

        function startGeneratingBuildings() {
            buildingInterval = setInterval(() => {
                if (!gameActive) return;
                const building = document.createElement('div');
                building.className = 'building';
                building.style.height = `${Math.random() * 200 + 100}px`;
                building.style.width = `${Math.random() * 60 + 40}px`;
                building.style.background = `hsla(${Math.random() * 60 + 200}, 70%, 40%, 0.3)`;
                building.style.left = `${Math.random() * 20 + 100}%`;
                building.style.animationDuration = `${8 - gameSpeed}s`;
                gameContainer.appendChild(building);
                building.addEventListener('animationend', () => building.remove());
            }, 2000);
        }

        function startGeneratingClouds() {
            cloudInterval = setInterval(() => {
                if (!gameActive) return;
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.width = `${Math.random() * 100 + 50}px`;
                cloud.style.height = `${(Math.random() * 100 + 50) * 0.6}px`;
                cloud.style.top = `${Math.random() * 200 + 20}px`;
                cloud.style.opacity = Math.random() * 0.3 + 0.1;
                cloud.style.animationDuration = `${Math.random() * 10 + 15}s`;
                gameContainer.appendChild(cloud);
                cloud.addEventListener('animationend', () => cloud.remove());
            }, 3000);
        }

        function startUpdatingAIScores() {
            const aiScoreInterval = setInterval(() => {
                if (!gameActive) { clearInterval(aiScoreInterval); return; }
                aiPlayers.forEach(ai => {
                    ai.score += Math.round(ai.scoreIncrement * (0.8 + Math.random() * 0.4));
                    document.getElementById(`ai-score-${ai.id}`).textContent = ai.score;
                });
            }, 1000);
            setTimeout(() => { if (gameActive) endRound(); }, 30000);
        }

        // --- CHATBOT FUNCTIONS ---
        function openChatbot() {
            chatbotModal.style.display = 'flex';
            if (chatMessages.children.length === 0) addBotMessage("Hi there! I'm your Gemini Healthy Coach ü§ñ. What can I help you with?");
        }
        
        function closeChatbot() { chatbotModal.style.display = 'none'; }
        
        function handleChatKeyPress(e) { if (e.key === 'Enter') sendMessage(); }
        
        // INTEGRATED GEMINI API FUNCTION
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // 1. Add User Message to UI
            addUserMessage(message);
            chatInput.value = '';
            showTypingIndicator();
            
            try {
                // Check for API Key
                if (GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE" || GEMINI_API_KEY === "") {
                    throw new Error("API Key Missing");
                }

                // 2. Add to History
                chatHistory.push({ role: "user", parts: [{ text: message }] });

                // 3. Prepare the Payload for REST API
                // Note: systemInstruction must be at the top level
                const payload = {
                    contents: chatHistory,
                    systemInstruction: {
                        parts: [{ text: SYSTEM_INSTRUCTION }]
                    }
                };
                
                // 4. Update URL with current key (in case it was changed after load)
                const currentUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

                // 5. Send Request
                const response = await fetch(currentUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || "API Error");
                }

                const data = await response.json();
                const botResponse = data.candidates[0].content.parts[0].text;

                // 6. Add Bot Response to History and UI
                chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                
                hideTypingIndicator();
                addBotMessage(botResponse);

            } catch (error) {
                hideTypingIndicator();
                console.error("Gemini Error:", error);
                if (error.message === "API Key Missing") {
                    addBotMessage("‚ö†Ô∏è Please open the code file (index.html) and paste your Google API Key in the 'GEMINI_API_KEY' variable!");
                } else {
                    addBotMessage(`Oops! Connection error: ${error.message}.`);
                }
            }
        }
        
        function addUserMessage(msg) {
            const div = document.createElement('div');
            div.className = 'message user';
            div.textContent = msg;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addBotMessage(msg) {
            const div = document.createElement('div');
            div.className = 'message bot';
            div.textContent = msg;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showTypingIndicator() {
            const div = document.createElement('div');
            div.className = 'typing-indicator';
            div.id = 'typing-indicator';
            div.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        // Init
        window.addEventListener('resize', () => { if(gameActive) updatePlayerPosition(); });
        let touchStartX = 0;
        gameContainer.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
        gameContainer.addEventListener('touchend', e => {
            if (!gameActive) return;
            const diff = e.changedTouches[0].clientX - touchStartX;
            if (Math.abs(diff) > 50) {
                if (diff > 0 && playerLane < 2) { playerLane++; updatePlayerPosition(); }
                else if (diff < 0 && playerLane > 0) { playerLane--; updatePlayerPosition(); }
            } else if (!isJumping) jump();
        });
    </script>
</body>
</html>
